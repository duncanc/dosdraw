'use strict';(function(){function H(a){a-=179;return!Number.isInteger(a)||0>a||a>=Q.length?0:Q[a]}function G(a){return W[a]||0}function P(a,c,g,d,m,h,k){let [f,p]=a<g?[a,g]:[g,a],[v,t]=c<d?[c,d]:[d,c];a=k?32:0;k=k?16:0;if(v===t)if(f===p)h(f,v,G(15));else{h(f,v,G(H(m(f,v))&-33|8|a));for(k=f+1;k<p;k++)h(k,v,G(H(m(k,v))&-33|12|a));h(p,v,G(H(m(p,v))&-33|4|a))}else if(f===p){h(f,v,G(H(m(f,v))&-17|2|k));for(a=v+1;a<t;a++)h(f,a,G(H(m(f,a))&-17|3|k));h(f,t,G(H(m(f,t))&-17|1|k))}else{h(f,v,G(H(m(f,v))&-49|
10|a|k));for(c=f+1;c<p;c++)h(c,v,G(H(m(c,v))&-33|12|a));h(p,v,G(H(m(p,v))&-49|6|a|k));for(c=v+1;c<t;c++)h(f,c,G(H(m(f,c))&-17|3|k)),h(p,c,G(H(m(p,c))&-17|3|k));h(f,t,G(H(m(f,t))&-49|9|a|k));for(c=f+1;c<p;c++)h(c,t,G(H(m(c,t))&-33|12|a));h(p,t,G(H(m(p,t))&-49|5|k|a))}}function*O(a,c,g,d){let m=Math.abs(g-a),h=Math.abs(d-c),k=a<g?1:-1,f=c<d?1:-1,p=m-h;for(;;){yield[a,c];if(a===g&&c===d)break;let v=2*p;v>-h&&(p-=h,a+=k);v<m&&(p+=m,c+=f)}}function*R(a,c,g,d){let m=Math.sign(g-a),h=Math.sign(d-c);if(0===
m)if(0===h)yield[a,c];else for(g=c;g!==d+h;g+=h)yield[a,g];else if(0===h)for(;a!==g+m;a+=m)yield[a,c];else for(;c!==d+h;c+=h)for(let k=a;k!==g+m;k+=m)yield[k,c]}function*S(a,c,g,d){let m=Math.sign(g-a),h=Math.sign(d-c);if(0===m)if(0===h)yield[a,c];else for(g=c;g!==d+h;g+=h)yield[a,g];else if(0===h)for(d=a;d!==g+m;d+=m)yield[d,c];else{for(let k=a;k!==g+m;k+=m)yield[k,c];for(c+=h;c!==d;c+=h)yield[a,c],yield[g,c];for(;a!==g+m;a+=m)yield[a,d]}}function X(){return new Promise((a,c)=>{let g=document.createElement("input");
g.type="file";g.onchange=d=>{var m;(null===(m=g.files)||void 0===m?0:m.length)?a(g.files[0]):a(null)};g.click()})}function F(a,c){let g=0;for(;a&c;){var d=Math.clz32(c);d=32-Math.clz32(~c<<d>>>d);d=c>>>d<<d;d&a&&(g|=d,a&=~d);c&=~d}return g}function Y(a,c,g,d,m,h,k){if(!(0>a||0>c||80<=a||25<=c)){var f=Math.floor(a%1*8),p=Math.floor(c%1*8);a=Math.floor(a);c=Math.floor(c);var {charCode:v,bgColor:t,fgColor:M}=g(a,c);if(t===M||32===v||255===v)v=0;var C=!!(m[v][p]&128>>>f),I=C?M:t,D=[],J=C?0:255,y=C?0:
65535,N=F(128>>>f,m[v][p]^J),E=F(32768>>>p,h[v][f]^y);a:if(0!==c){var e=N;for(let b=p-1;0<=b;b--)if(e=F(e,m[v][b]^J),0===e)break a;D.push({x:a,y:c-1,side:"bottom",mask:e})}a:if(24!==c){for(p+=1;8>p;p++)if(N=F(N,m[v][p]^J),0===N)break a;D.push({x:a,y:c+1,side:"top",mask:N})}a:if(0!==a){J=E;for(p=f-1;0<=p;p--)if(J=F(J,h[v][p]^y),0===J)break a;D.push({x:a-1,y:c,side:"right",mask:J})}a:if(79!==a){for(f+=1;8>f;f++)if(E=F(E,h[v][f]^y),0===E)break a;D.push({x:a+1,y:c,side:"left",mask:E})}C?d(a,c,v,k,t):
d(a,c,v,M,k);for(a=new Set([`${a},${c}`]);0<D.length;){let {x:b,y:l,side:w,mask:n}=D.pop(),{charCode:r,bgColor:x,fgColor:A}=g(b,l);if(x!==I&&A!==I||177===r||176===r&&x!==I||178===r&&A!==I)a.add(`${b},${l}`);else{if(A===x||32===r||255===r)r=0;c=x===I?255:0;C=x===I?65535:0;switch(w){case "top":for(y=E=f=0;16>y;y++){n=F(n,m[r][y]^c);if(0===n)break;n&128&&(f|=F(1<<y,h[r][0]^C));n&1&&(E|=F(1<<y,h[r][7]^C))}0<y&&(n&&24!==l&&!a.has(`${b},${l+1}`)&&D.push({x:b,y:l+1,side:"top",mask:n}),f&&0!==b&&!a.has(`${b-
1},${l}`)&&D.push({x:b-1,y:l,side:"right",mask:f}),E&&79!==b&&!a.has(`${b+1},${l}`)&&D.push({x:b+1,y:l,side:"left",mask:E}),x===I?d(b,l,r,A,k):d(b,l,r,k,x),a.add(`${b},${l}`));break;case "bottom":E=f=0;for(y=15;0<=y;y--){n=F(n,m[r][y]^c);if(0===n)break;n&128&&(f|=F(1<<y,h[r][0]^C));n&1&&(E|=F(1<<y,h[r][7]^C))}15>y&&(n&&0!==l&&!a.has(`${b},${l-1}`)&&D.push({x:b,y:l-1,side:"bottom",mask:n}),f&&0!==b&&!a.has(`${b-1},${l}`)&&D.push({x:b-1,y:l,side:"right",mask:f}),E&&79!==b&&!a.has(`${b+1},${l}`)&&D.push({x:b+
1,y:l,side:"left",mask:E}),x===I?d(b,l,r,A,k):d(b,l,r,k,x),a.add(`${b},${l}`));break;case "left":for(y=E=f=0;8>y;y++){n=F(n,h[r][y]^C);if(0===n)break;n&32768&&(E|=F(128>>y,m[r][15]^c));n&1&&(f|=F(128>>y,m[r][0]^c))}0<y&&(n&&79!==b&&!a.has(`${b+1},${l}`)&&D.push({x:b+1,y:l,side:"left",mask:n}),f&&0!==l&&!a.has(`${b},${l-1}`)&&D.push({x:b,y:l-1,side:"bottom",mask:f}),E&&24!==l&&!a.has(`${b},${l+1}`)&&D.push({x:b,y:l+1,side:"top",mask:E}),x===I?d(b,l,r,A,k):d(b,l,r,k,x),a.add(`${b},${l}`));break;case "right":E=
f=0;for(y=7;0<=y;y--){n=F(n,h[r][y]^C);if(0===n)break;n&32768&&(E|=F(128>>y,m[r][15]^c));n&1&&(f|=F(128>>y,m[r][0]^c))}7>y&&(n&&0!==b&&!a.has(`${b-1},${l}`)&&D.push({x:b-1,y:l,side:"right",mask:n}),f&&0!==l&&!a.has(`${b},${l-1}`)&&D.push({x:b,y:l-1,side:"bottom",mask:f}),E&&24!==l&&!a.has(`${b},${l+1}`)&&D.push({x:b,y:l+1,side:"top",mask:E}),x===I?d(b,l,r,A,k):d(b,l,r,k,x),a.add(`${b},${l}`))}}}}}let T=1===(new Uint8Array((new Uint16Array([1])).buffer))[0];var K;(function(a){a[a.Tile=255]="Tile";
a[a.ForegroundColor=3840]="ForegroundColor";a[a.BackgroundColor=61440]="BackgroundColor";a[a.All=65535]="All"})(K||(K={}));var U;(function(a){a[a.Black=0]="Black";a[a.DarkBlue=1]="DarkBlue";a[a.DarkGreen=2]="DarkGreen";a[a.DarkCyan=3]="DarkCyan";a[a.DarkRed=4]="DarkRed";a[a.DarkMagenta=5]="DarkMagenta";a[a.Brown=6]="Brown";a[a.LightGrey=7]="LightGrey";a[a.DarkGrey=8]="DarkGrey";a[a.Blue=9]="Blue";a[a.Green=10]="Green";a[a.Cyan=11]="Cyan";a[a.Red=12]="Red";a[a.Magenta=13]="Magenta";a[a.Yellow=14]=
"Yellow";a[a.White=15]="White"})(U||(U={}));let V="#000 #008 #080 #088 #800 #808 #880 #ccc #888 #00f #0f0 #0ff #f00 #f0f #ff0 #fff".split(" ");class Z{constructor(a){this.drawChar=a;this.buffer=new Uint16Array(2E3);this.buffer.fill(1792);this.canvas=document.createElement("canvas");this.canvas.width=640;this.canvas.height=400;this.ctx=this.canvas.getContext("2d");if(!this.ctx)throw Error("unable to get canvas context");}getBrush(a,c,g,d){if(!Number.isInteger(a)||!Number.isInteger(c))throw new TypeError("x and y must be integers");
if(!Number.isInteger(g)||!Number.isInteger(c))throw new TypeError("width and height must be integers");if(0>a||0>c||0>g||0>d||80<a+g||25<c+d)throw new RangeError("edges exceed screen");let m=new Uint16Array(g*d);for(let h=0;h<d;h++)m.set(this.buffer.subarray(80*(c+h)+a,80*(c+h)+a+g),h*g);return{data:m,width:g,height:d}}putBrush(a,c,g){let d,m,h=a.data;if(0>c){d=-c;if(d>=a.width)return;c=0}else d=0;m=Math.min(80-c,c+a.width);if(0>g){h=h.subarray(g*a.width);if(0===h.length)return;g=0}for(let k=0;k<
a.height;k++)if(!(0>g+k)){if(25<=g+k)break;this.buffer.set(h.subarray((g+k)*a.width+d,(g+k)*a.width+m),80*g+c);for(let f=d;f<m;f++)this.updateCanvas(g+k,c+f)}}updateCanvas(a,c){let g=this.buffer[80*c+a];this.drawChar(this.ctx,a,c,g&255,g>>8&15,g>>12&15)}getCharInfo(a,c){a=this.buffer[80*c+a];return{charCode:a&255,fgColor:a>>8&15,bgColor:a>>12&15}}getChar(a,c){return this.buffer[80*c+a]&255}putChar(a,c,g,d,m){this.buffer[80*c+a]=g|d<<8|m<<12;this.updateCanvas(a,c)}setChar(a,c,g,d,m,h=K.All){this.buffer[80*
c+a]=this.buffer[80*c+a]&~h|(g|d<<8|m<<12)&h;this.updateCanvas(a,c)}fill(a,c,g,d=K.All){a=(a|c<<8|g<<12)&d;for(c=0;c<this.buffer.length;c++)this.buffer[c]=this.buffer[c]&~d|a,this.updateCanvas(c%80,Math.floor(c/80))}putVHalf(a,c,g){var d=this.buffer[80*(c>>1)+a];let m=d>>>8&15,h=d>>>12&15,k=c&1;switch(d&255){case 219:case 8:case 10:d=m;break;default:d=h;break;case 220:d=1===k?h:m;break;case 223:d=1===k?m:h}d===g?this.putChar(a,c>>1,219,g,h):0===k?this.putChar(a,c>>1,223,g,d):this.putChar(a,c>>1,220,
g,d)}putHHalf(a,c,g){var d=this.buffer[80*c+(a>>1)];let m=d>>>8&15,h=d>>>12&15,k=a&1;switch(d&255){case 219:case 8:case 10:d=m;break;default:d=h;break;case 222:d=1===k?h:m;break;case 221:d=1===k?m:h}d===g?this.putChar(a>>1,c,219,g,h):0===k?this.putChar(a>>1,c,221,g,d):this.putChar(a>>1,c,222,g,d)}saveBlob(){if(T)return new Blob([this.buffer]);let a=new Uint16Array(this.buffer);for(let c=0;c<a.length;c++)a[c]=a[c]>>8|a[c]<<8;return new Blob([a],{type:"application/octet-stream"})}async loadBlob(a){a=
await a.arrayBuffer();if(a.byteLength!==this.buffer.byteLength)throw Error("invalid file");a=new Uint16Array(a);if(!T)for(var c=0;c<a.length;c++)a[c]=a[c]>>8|a[c]<<8;this.buffer.set(a);for(a=0;25>a;a++)for(c=0;80>c;c++)this.updateCanvas(c,a)}}let W=new Uint8Array([0,193,194,179,180,217,191,180,195,192,218,195,196,193,194,197,0,208,210,186,180,189,183,182,195,211,214,199,196,208,210,215,0,180,203,179,181,190,184,181,198,212,213,198,205,207,209,216,0,208,210,186,181,188,187,185,198,200,201,204,205,
202,203,206]),Q=new Uint8Array([3,7,39,23,22,38,55,19,54,53,21,37,6,9,13,14,11,12,15,43,27,57,58,61,62,59,44,63,45,29,46,30,25,41,42,26,31,47,5,10]),aa=fetch("./chardata.png"),ba=a=>{var c=document.createElement("canvas");c.width=a.width;c.height=a.height;c=c.getContext("2d");if(!c)throw Error("unable to create 2D canvas");c.drawImage(a,0,0);var g=a.width/9;a=new Uint8Array(4096);for(let d=0;256>d;d++){const {data:m}=c.getImageData(d%g*9,16*Math.floor(d/g),8,16);for(let h=0;16>h;h++)a[16*d+h]=m[32*
h+3]?128:0,a[16*d+h]|=m[4*(8*h+1)+3]?64:0,a[16*d+h]|=m[4*(8*h+2)+3]?32:0,a[16*d+h]|=m[4*(8*h+3)+3]?16:0,a[16*d+h]|=m[4*(8*h+4)+3]?8:0,a[16*d+h]|=m[4*(8*h+5)+3]?4:0,a[16*d+h]|=m[4*(8*h+5)+3]?2:0,a[16*d+h]|=m[4*(8*h+7)+3]?1:0}c=Array(256);for(g=0;256>g;g++)c[g]=a.subarray(16*g,16*(g+1));return c},ca=a=>{const c=new Uint16Array(2048);for(var g=0;256>g;g++)for(let d=0;8>d;d++)for(let m=0;16>m;m++)c[8*g+d]|=(a[g][m]>>>7-d&1)<<m;a=Array(256);for(g=0;256>g;g++)a[g]=c.subarray(8*g,8*(g+1));return a};window.addEventListener("DOMContentLoaded",
async function(){var a=await (await aa).blob();let c=await createImageBitmap(a),g=c.width/9,d=(e,b,l,w,n,r)=>{e.save();e.globalCompositeOperation="source-over";e.fillStyle=V[r];e.fillRect(8*b,16*l,8,16);e.globalCompositeOperation="destination-out";e.drawImage(c,w%g*9,16*Math.floor(w/g),8,16,8*b,16*l,8,16);e.globalCompositeOperation="destination-over";e.fillStyle=V[n];e.fillRect(8*b,16*l,8,16);e.restore()},m=ba(c),h=ca(m),k=new Z(d),f=document.getElementById("editor"),p=f.getContext("2d");if(!p)throw Error("unable to create canvas context");
let v=K.All;document.getElementById("tile").onchange=e=>{v=e.target.checked?v|K.Tile:v&~K.Tile};document.getElementById("fgcolor").onchange=e=>{v=e.target.checked?v|K.ForegroundColor:v&~K.ForegroundColor};document.getElementById("bgcolor").onchange=e=>{v=e.target.checked?v|K.BackgroundColor:v&~K.BackgroundColor};let t=[7,0,0],M=document.querySelector(".palette");M.onpointerdown=e=>{if("mouse"===e.pointerType&&(0===e.button||2===e.button)){var b=0===e.button?"foreground-selected":"background-selected";
for(let l=e.target;l&&!l.classList.contains("palette");l=l.parentElement)if("value"in l.dataset){let w=M.querySelectorAll(`.${b}`);for(let n=0;n<w.length;n++)w[n].classList.remove(b);l.classList.add(b);t[e.button]=+l.dataset.value;e.preventDefault();e.stopPropagation();break}}};M.oncontextmenu=e=>{e.preventDefault()};let C=[219,0,0],I={freehand:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:r,pointerId:x}=e;if(0===r||2===r){function A(u){u.pointerId===x&&u.button===r&&(f.removeEventListener("pointermove",
q),f.removeEventListener("pointerup",A))}function q(u){if(u.pointerId===x){var z=Math.floor(80*(u.clientX-b.x)/b.width);u=Math.floor(25*(u.clientY-b.y)/b.height);for(const [B,L]of O(w,n,z,u))k.setChar(B,L,C[r],t[0],t[2],v);p.drawImage(k.canvas,0,0);w=z;n=u}}f.setPointerCapture(x);var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width);e=Math.floor(25*(e.clientY-b.y)/b.height);k.setChar(l,e,C[r],t[0],t[2],v);p.drawImage(k.canvas,0,0);var w=l,n=e;f.addEventListener("pointermove",q);
f.addEventListener("pointerup",A)}}}},vbFreehand:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:r,pointerId:x}=e;if(0===r||2===r){function A(u){u.pointerId===x&&u.button===r&&(f.removeEventListener("pointermove",q),f.removeEventListener("pointerup",A))}function q(u){if(u.pointerId===x){var z=Math.floor(80*(u.clientX-b.x)/b.width);u=Math.floor(50*(u.clientY-b.y)/b.height);for(const [B,L]of O(w,n,z,u))k.putVHalf(B,L,t[r]);p.drawImage(k.canvas,0,0);w=z;n=u}}f.setPointerCapture(x);
var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width);e=Math.floor(50*(e.clientY-b.y)/b.height);k.putVHalf(l,e,t[r]);p.drawImage(k.canvas,0,0);var w=l,n=e;f.addEventListener("pointermove",q);f.addEventListener("pointerup",A)}}}},hbFreehand:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:r,pointerId:x}=e;if(0===r||2===r){function A(u){u.pointerId===x&&u.button===r&&(f.removeEventListener("pointermove",q),f.removeEventListener("pointerup",A))}function q(u){if(u.pointerId===
x){var z=Math.floor(160*(u.clientX-b.x)/b.width);u=Math.floor(25*(u.clientY-b.y)/b.height);for(const [B,L]of O(w,n,z,u))k.putHHalf(B,L,t[r]);p.drawImage(k.canvas,0,0);w=z;n=u}}f.setPointerCapture(x);var b=f.getBoundingClientRect(),l=Math.floor(160*(e.clientX-b.x)/b.width);e=Math.floor(25*(e.clientY-b.y)/b.height);k.putHHalf(l,e,t[r]);p.drawImage(k.canvas,0,0);var w=l,n=e;f.addEventListener("pointermove",q);f.addEventListener("pointerup",A)}}}},lines:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:n,
pointerId:r}=e;if(0===n||2===n){function x(q){if(q.pointerId===r&&q.button===n){var u=Math.floor(80*(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);for(const [z,B]of O(l,w,u,q))k.setChar(z,B,C[n],t[0],t[2],v);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);f.removeEventListener("pointermove",A);f.removeEventListener("pointerup",x)}}function A(q){if(q.pointerId===r){var u=Math.floor(80*(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);p.globalCompositeOperation=
"copy";p.drawImage(k.canvas,0,0);for(const [z,B]of O(l,w,u,q))d(p,z,B,C[n],t[0],t[2])}}f.setPointerCapture(r);var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width),w=Math.floor(25*(e.clientY-b.y)/b.height);d(p,l,w,C[n],t[0],t[2]);f.addEventListener("pointermove",A);f.addEventListener("pointerup",x)}}}},filledBox:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:n,pointerId:r}=e;if(0===n||2===n){function x(q){if(q.pointerId===r&&q.button===n){var u=Math.floor(80*
(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);for(const [z,B]of R(l,w,u,q))k.setChar(z,B,C[n],t[0],t[2],v);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);f.removeEventListener("pointermove",A);f.removeEventListener("pointerup",x)}}function A(q){if(q.pointerId===r){var u=Math.floor(80*(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);for(const [z,B]of R(l,w,u,q))d(p,z,B,C[n],t[0],t[2])}}f.setPointerCapture(r);
var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width),w=Math.floor(25*(e.clientY-b.y)/b.height);d(p,l,w,C[n],t[0],t[2]);f.addEventListener("pointermove",A);f.addEventListener("pointerup",x)}}}},emptyBox:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:n,pointerId:r}=e;if(0===n||2===n){function x(q){if(q.pointerId===r&&q.button===n){var u=Math.floor(80*(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);for(const [z,B]of S(l,w,u,q))k.setChar(z,B,
C[n],t[0],t[2],v);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);f.removeEventListener("pointermove",A);f.removeEventListener("pointerup",x)}}function A(q){if(q.pointerId===r){var u=Math.floor(80*(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);for(const [z,B]of S(l,w,u,q))d(p,z,B,C[n],t[0],t[2])}}f.setPointerCapture(r);var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width),w=Math.floor(25*
(e.clientY-b.y)/b.height);d(p,l,w,C[n],t[0],t[2]);f.addEventListener("pointermove",A);f.addEventListener("pointerup",x)}}}},singleBorder:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:n,pointerId:r}=e;if(0===n||2===n){function x(q){q.pointerId===r&&q.button===n&&(P(l,w,Math.floor(80*(q.clientX-b.x)/b.width),Math.floor(25*(q.clientY-b.y)/b.height),(u,z)=>k.getChar(u,z),(u,z,B)=>k.putChar(u,z,B,t[0],t[2]),!1),p.globalCompositeOperation="copy",p.drawImage(k.canvas,0,0),f.removeEventListener("pointermove",
A),f.removeEventListener("pointerup",x))}function A(q){if(q.pointerId===r){var u=Math.floor(80*(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);P(l,w,u,q,(z,B)=>k.getChar(z,B),(z,B,L)=>d(p,z,B,L,t[0],t[2]),!1)}}f.setPointerCapture(r);var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width),w=Math.floor(25*(e.clientY-b.y)/b.height);d(p,l,w,G(15),t[0],t[2]);f.addEventListener("pointermove",A);f.addEventListener("pointerup",
x)}}}},doubleBorder:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:n,pointerId:r}=e;if(0===n||2===n){function x(q){q.pointerId===r&&q.button===n&&(P(l,w,Math.floor(80*(q.clientX-b.x)/b.width),Math.floor(25*(q.clientY-b.y)/b.height),(u,z)=>k.getChar(u,z),(u,z,B)=>k.putChar(u,z,B,t[0],t[2]),!0),p.globalCompositeOperation="copy",p.drawImage(k.canvas,0,0),f.removeEventListener("pointermove",A),f.removeEventListener("pointerup",x))}function A(q){if(q.pointerId===r){var u=Math.floor(80*
(q.clientX-b.x)/b.width);q=Math.floor(25*(q.clientY-b.y)/b.height);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0);P(l,w,u,q,(z,B)=>k.getChar(z,B),(z,B,L)=>d(p,z,B,L,t[0],t[2]),!0)}}f.setPointerCapture(r);var b=f.getBoundingClientRect(),l=Math.floor(80*(e.clientX-b.x)/b.width),w=Math.floor(25*(e.clientY-b.y)/b.height);d(p,l,w,G(15),t[0],t[2]);f.addEventListener("pointermove",A);f.addEventListener("pointerup",x)}}}},colorFloodFill:()=>{f.onpointerdown=e=>{if("mouse"===e.pointerType){const {button:l}=
e;if(0===l||2===l){var b=f.getBoundingClientRect();Y(80*(e.clientX-b.x)/b.width,25*(e.clientY-b.y)/b.height,(w,n)=>k.getCharInfo(w,n),(w,n,r,x,A)=>k.putChar(w,n,r,x,A),m,h,t[l]);p.globalCompositeOperation="copy";p.drawImage(k.canvas,0,0)}}}}};I.freehand();let D=document.getElementById("tool-selector"),J=D.value;document.body.classList.add("tool-"+J);D.onchange=e=>{I[D.value]();document.body.classList.remove("tool-"+J);J=D.value;document.body.classList.add("tool-"+J)};f.oncontextmenu=e=>{e.preventDefault()};
let y=document.getElementById("char-picker");a=y.getContext("2d");if(!a)throw Error("unable to create canvas context");for(let e=0;256>e;e++)d(a,e%64,Math.floor(e/64),e,7,0);let N=document.querySelector(".left-pick"),E=document.querySelector(".right-pick");y.onpointerdown=e=>{if("mouse"===e.pointerType&&(0===e.button||2===e.button)){var b=y.getBoundingClientRect(),l=Math.floor(64*(e.clientX-b.x)/b.width);b=Math.floor(4*(e.clientY-b.y)/b.height);var w=2===e.button?E:N;C[e.button]=64*b+l;w.style.left=
`${8*l}px`;w.style.top=`${16*b}px`}};y.oncontextmenu=e=>{e.preventDefault()};document.getElementById("save-image").onclick=e=>{e=k.saveBlob();e=URL.createObjectURL(e);let b=document.createElement("a");b.download="dosimage.dat";b.href=e;b.click()};document.getElementById("load-image").onclick=async e=>{if(e=await X()){try{await k.loadBlob(e)}catch(b){alert(b);return}p.drawImage(k.canvas,0,0)}};document.getElementById("clear-image").onclick=e=>{k.fill(C[2],t[0],t[2],v);p.drawImage(k.canvas,0,0)}},{once:!0})})()
